let controller=null;const secondaryChatbotContainer=document.querySelector(".secondary-chatbot");let isSecondaryChatClosed=!0;const UNIQUE_USER_ID=sessionStorage.getItem("UNIQUE_USER_ID")?sessionStorage.getItem("UNIQUE_USER_ID"):generateGuid();function addScrollListener(){let t=!1;document.addEventListener("scroll",()=>{var e;700<window.scrollY?t||(showSecondaryChatInput(),t=!0):(e=secondaryChatbotContainer.classList.contains("is-open"),t&&!e&&(hideSecondaryChatbotCompletely(),t=!1))})}function loadChatsFromSessionStorage(){var e=JSON.parse(sessionStorage.getItem("bot-chats"));e&&e.length&&(secondaryChatbotContainer.querySelectorAll(".chat-item").forEach(e=>{e.remove()}),e.forEach(e=>{var t=document.createElement("div"),e=(t.innerHTML=e,t.querySelector("div"));e.classList.contains("question-box")&&e.classList.add("user-input"),gsap.set(e,{opacity:1}),secondaryChatbotContainer.querySelector(".chats").append(e)}))}sessionStorage.setItem("UNIQUE_USER_ID",UNIQUE_USER_ID),addSecondaryChatInputListener(),addCloseSecondaryChatClickListener(),addScrollListener(),loadChatsFromSessionStorage();let timeoutId;function hideSecondaryChatbotCompletely(){clearTimeout(timeoutId);var e=secondaryChatbotContainer.querySelector(".chatbot-icon-wrapper"),t=(secondaryChatbotContainer.classList.remove("is-open"),gsap.timeline({onComplete:()=>{timeoutId=setTimeout(()=>{secondaryChatbotContainer.querySelector(".input-container").style.visibility="hidden"},50)}}));t.to(secondaryChatbotContainer.querySelector(".input-wrapper"),{width:0,duration:.3,delay:.3}),t.to(e,{top:0,opacity:0,duration:.3},"<"),handleCloseSecondaryChat()}async function showSecondaryChatInput(){clearTimeout(timeoutId);var e=gsap.timeline(),t=(removeHideClass(secondaryChatbotContainer.querySelector(".secondary-chatbot-wrapper")),secondaryChatbotContainer.querySelector(".input-wrapper"));const o=secondaryChatbotContainer.querySelector(".chatbot-icon-wrapper");var a=secondaryChatbotContainer.querySelector(".input-wrapper span");return isSecondaryChatClosed=!0,await repositionSecondaryChatBot(),secondaryChatbotContainer.querySelector(".input-container").style.width="auto",secondaryChatbotContainer.querySelector(".input-container").style.visibility="visible",secondaryChatbotContainer.style.visibility="visible",gsap.set(secondaryChatbotContainer.querySelector(".chatbot-icon-wrapper"),{top:992<window.innerWidth?"-8px":"0px"}),e.to(o,{opacity:1,duration:.3,onComplete:()=>{o.style.display="flex"}},"start"),e.to(t,{scale:1,duration:.5,width:225},"start"),e.to(t.querySelector("input"),{opacity:1,duration:.3},"<"),e.to(a,{right:10,scale:1,duration:.3},"<"),e}async function handleAPIResponse(e){var t;e.error||({responsesToShow:e,choices:t}=extractDataFromResponse(e.data),await hideSecondaryChatBotLoader(),renderSecondaryChatResult(e),Array.isArray(t)&&t.length&&renderSecondaryChatChoices(t))}function extractDataFromResponse(e){return{responsesToShow:e.filter(e=>"text"===e.type||"visual"===e.type),choices:e.find(e=>"choice"===e.type)?.payload?.buttons?.map(e=>{var t=e?.request?.payload?.actions?.find(e=>"open_url"===e.type);let o=void 0;return t&&(o=t.payload.url),{name:e.name,type:e.request.type,url:o}})}}function saveToSessionStorage(e){e=e.querySelectorAll(".chat-item"),e=Array.from(e);const t=[];e.forEach(e=>{t.push(e.outerHTML)});e=JSON.stringify(t);sessionStorage.setItem("bot-chats",e)}function hideSecondaryChatBotLoader(){return new Promise(e=>{const t=secondaryChatbotContainer.querySelector(".chatbot-icon-wrapper");gsap.to(t.querySelector(".bot-loader"),{opacity:0,onComplete:()=>{removeHideClass(t),e()}})})}function showSecondaryChatBotLoader(){return new Promise(e=>{const t=secondaryChatbotContainer.querySelector(".chatbot-icon-wrapper");gsap.to(t.querySelector(".bot-loader"),{opacity:1,onComplete:()=>{removeHideClass(t),e()}})})}function renderSecondaryChatResult(e){var t=getSecondaryChatBotIconNewPosition();e.forEach((e,t)=>{const o=document.createElement("div");var a;"text"===e.type&&e.payload.message.split("\n").forEach(e=>{var t;""!==e.trim()&&((t=document.createElement("p")).textContent=e.trim(),o.appendChild(t))}),"visual"===e.type&&(e=e.payload.image,(a=document.createElement("img")).setAttribute("src",e),o.appendChild(a)),secondaryChatbotContainer.querySelector(".chats").innerHTML+=`<div class="chat-item response-box ${0<t?"negative-margin":""}">
      <p>${o.innerHTML}</p>
    </div>`}),scrollSecondaryChatPartially(t),secondaryChatbotContainer.querySelector("input").disabled=!1,saveToSessionStorage(secondaryChatbotContainer)}function renderSecondaryChatChoices(e){const t=secondaryChatbotContainer.querySelector(".choices");removeHideClass(t),t.innerHTML="",isSecondaryChatClosed?(e.forEach(e=>{t.innerHTML+=`<div class='choice' fd-redirect="${e.url}"  fd-choice-type='${e.type}'>${e.name}</div>`}),gsap.fromTo(t.querySelectorAll(".choice"),{opacity:0,y:10},{opacity:1,stagger:.1,y:0}),addClickListenerToSecondaryChatBotChoices()):addHideClass(t)}function scrollSecondaryChatPartially(e){secondaryChatbotContainer.querySelector(".chats").scrollTo({top:e,behavior:"smooth"})}function repositionSecondaryChatBot(){return new Promise(e=>{var t=getSecondaryChatBotIconNewPosition(),o=secondaryChatbotContainer.querySelector(".chatbot-icon-wrapper");gsap.to(o,{top:t,onComplete:e})})}function getSecondaryChatBotIconNewPosition(){let t=0;var e=secondaryChatbotContainer.querySelectorAll(".chat-item");if(!e?.length)return-8;let o=0;return e.forEach(e=>{e.classList.contains("negative-margin")&&o++,t+=e.offsetHeight+36}),t+28-20*o}function addClickListenerToSecondaryChatBotChoices(){secondaryChatbotContainer.querySelectorAll(".choices .choice").forEach(t=>{t.addEventListener("click",async function(){var e;t.getAttribute("undefined"!==t.getAttribute("fd-redirect"))?(e=t.getAttribute("fd-redirect"),window.location.href=e):await handleUserInteraction(t.innerText,t.getAttribute("fd-choice-type"))})})}function addSecondaryChatInputListener(){const t=secondaryChatbotContainer.querySelector("input");var e=secondaryChatbotContainer.querySelector(".input-wrapper span>svg");t.addEventListener("keypress",async function(e){13===(e.keyCode||e.which)&&(e=t.value)&&(t.value="",secondaryChatbotContainer.classList.add("is-open"),await handleUserInteraction(e))}),e.addEventListener("click",async function(){var e=t.value;e&&(t.value="",secondaryChatbotContainer.classList.add("is-open"),await handleUserInteraction(e))})}async function handleUserInteraction(e,t="text"){gsap.set(secondaryChatbotContainer.querySelector(".input-wrapper"),{width:992<window.innerWidth?500:"calc(100vw - 70px)"});secondaryChatbotContainer.querySelector("input").disabled=!0,addHideClass(secondaryChatbotContainer.querySelector(".choices")),appendUserInputToChatScreen(e),await repositionSecondaryChatBot(),showSecondaryChatBotLoader();var o=getSecondaryChatBotIconNewPosition(),o=(scrollSecondaryChatPartially(o),await makeAPIRequest(e,t));await handleAPIResponse(o)}function addCloseSecondaryChatClickListener(){secondaryChatbotContainer.querySelector(".close-chat").addEventListener("click",handleCloseSecondaryChat)}function addInputFocusListener(){[document.querySelector(".chat-input-wrap input"),document.querySelector(".secondary-chatbot-wrapper input")].forEach(e=>{e.addEventListener("focus",()=>{e.parentNode.style.borderColor="#1553F0",e.parentElement.querySelector("svg path").style.fill="#1553F0"}),e.addEventListener("blur",()=>{e.parentNode.style.borderColor="#DAE3E8",e.parentElement.querySelector("svg path").style.fill="#666D80"})})}function handleCloseSecondaryChat(){secondaryChatbotContainer.classList.remove("is-open"),isSecondaryChatClosed=!0,gsap.set(secondaryChatbotContainer.querySelector(".chatbot-icon-wrapper"),{opacity:0,top:992<window.innerWidth?"-8px":"0px"}),gsap.set(secondaryChatbotContainer.querySelector(".input-wrapper"),{width:225}),gsap.to(secondaryChatbotContainer.querySelector(".chatbot-icon-wrapper"),{duration:.3,opacity:1})}function appendUserInputToChatScreen(e){var t=secondaryChatbotContainer.querySelector(".chats"),o=document.createElement("div");o.classList.add("chat-item"),o.classList.add("question-box"),o.innerHTML=`<h4 class='question-box-question'>${e}</h4>`,t.append(o)}function generateGuid(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function saveToSessionStorage(e){e=e.querySelectorAll(".chat-item"),e=Array.from(e);const t=[];e.forEach(e=>{t.push(e.outerHTML)});e=JSON.stringify(t);sessionStorage.setItem("bot-chats",e)}function addHideClass(e){e.classList.add("hide")}function removeHideClass(e){e.classList.remove("hide")}async function makeAPIRequest(e,t){controller&&controller.abort();var o=(controller=new AbortController)["signal"],a=`https://general-runtime.voiceflow.com/state/user/${UNIQUE_USER_ID}/interact`,t={method:"POST",headers:{accept:"application/json",versionID:"65df5123b93dbe8b0c12a50c",projectID:"65df5123b93dbe8b0c12a50b","content-type":"application/json",Authorization:"VF.DM.65df5409684f33402629843c.CLK9k8XYwRxE7pbz"},body:JSON.stringify({action:"text"!==t?{type:t,payload:{label:""+e}}:{type:"text",payload:""+e},sessionID:UNIQUE_USER_ID,versionID:"65df5123b93dbe8b0c12a50c",projectID:"65df5123b93dbe8b0c12a50b",config:{tts:!1,stripSSML:!0,stopAll:!0,excludeTypes:["block","debug","flow"]}})};try{var r=await(await fetch(a,{...t,signal:o})).json();return await makeTranscriptRequest(),controller=null,{error:!1,data:r}}catch(e){return console.log("ERROR Intreaction request ",e),{error:!0,message:e?.response?.data?.message||e.message}}}async function makeTranscriptRequest(){var e={method:"PUT",headers:{accept:"application/json","content-type":"application/json",Authorization:"VF.DM.65df5409684f33402629843c.CLK9k8XYwRxE7pbz"},body:JSON.stringify({sessionID:UNIQUE_USER_ID,versionID:"65df5123b93dbe8b0c12a50c",projectID:"65df5123b93dbe8b0c12a50b",timestamp:""+(new Date).getTime(),platform:"webchat"})};try{var t=await(await fetch("https://api.voiceflow.com/v2/transcripts",e)).json();console.log({transript:t})}catch(e){console.log("Error making transcript request ",e)}}